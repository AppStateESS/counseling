"use strict";var _extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},ButtonGroup=React.createClass({displayName:"ButtonGroup",getInitialState:function(){return{}},getDefaultProps:function(){return{label:"Action",options:[{label:"Action1",handleClick:null,divider:!1}]}},render:function(){var a=this.props.options.map(function(a,b){return React.createElement(ButtonGroupOption,{key:b,label:a.label,handleClick:a.handleClick,divider:a.divider})});return React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"btn btn-default btn-sm dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},this.props.label," ",React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu"},a))}}),ButtonGroupOption=React.createClass({displayName:"ButtonGroupOption",getDefaultProps:function(){return{label:null,handleClick:null,divider:!1}},render:function(){return this.props.divider?React.createElement("li",{role:"separator",className:"divider"}):React.createElement("li",{onClick:this.props.handleClick},React.createElement("a",{style:{cursor:"pointer"}},this.props.label))}}),WaitingListStatus=React.createClass({displayName:"WaitingListStatus",getDefaultProps:function(){return{visitor:null,visitNumber:0,reload:null}},intakeComplete:function(){confirm("Click OK if student completed their intake form.")&&$.post("counseling/Admin/Dashboard/Waiting/",{command:"intakeComplete",visitorId:this.props.visitor.id},null,"json").done(function(a){this.props.reload()}.bind(this))},render:function(){return"1"===this.props.visitor.intake_complete?this.props.visitNumber>1?"0"===this.props.visitor.seen_last_visit?React.createElement("span",{className:"label label-danger"},"Unseen last visit"):React.createElement("span",{className:"label label-primary"},"Previously seen @ ",this.props.visitor.previously_seen):React.createElement("span",{className:"label label-success"},"Intake complete"):React.createElement("span",{className:"label label-danger",style:{cursor:"pointer"},title:"Click to acknowledge intake completion",onClick:this.intakeComplete},"Intake incomplete")}}),Summary=React.createClass({displayName:"Summary",getInitialState:function(){return{error:null,errorMessage:null}},getDefaultProps:function(){return{data:null,time:null}},serverError:function(){this.setState({error:!0,errorMessage:"Could not retrieve server data"})},render:function(){var a=null,b=null;return this.props.data?(a=this.props.data.currentTally,b=this.props.data.completeTally):(a={emergencies:0,walkin:0,appointment:0,other:0},b=a),React.createElement("div",{className:"summary"},this.state.error?React.createElement("div",{className:"alert alert-danger"},this.state.errorMessage):null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-6 left"},React.createElement("h3",null,"Current"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-4"},React.createElement(SummaryTotalWaiting,this.props.data)),React.createElement("div",{className:"col-sm-4"},React.createElement(SummaryEstimatedWait,this.props.data)),React.createElement("div",{className:"col-sm-4"},React.createElement(SummaryWaitingTally,a)))),React.createElement("div",{className:"col-sm-6 right"},React.createElement("h4",{className:"pull-right"},this.props.time),React.createElement("h3",null,"Today"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-2"},React.createElement(SummaryTotalSeen,this.props.data)),React.createElement("div",{className:"col-sm-3"},React.createElement(SummaryCompleted,this.props.data)),React.createElement("div",{className:"col-sm-3"},React.createElement(SummaryAverageWait,this.props.data)),React.createElement("div",{className:"col-sm-4"},React.createElement(SummaryWaitingTally,_extends({},b,{showLabels:!0})))))))}}),SummaryCompleted=React.createClass({displayName:"SummaryCompleted",getInitialState:function(){return{tooltip:!0}},getDefaultProps:function(){return{totalComplete:0,leaveReasons:null}},componentDidMount:function(){$(window).load(function(){this.loadTooltip()}.bind(this))},loadTooltip:function(){$(".total-complete div.big-number").popover({animation:!0,placement:"bottom",trigger:"hover",container:".summary .right",title:"Not seen reasons",html:!0}),$(".total-complete div.big-number").css("cursor","pointer"),this.setState({tooltip:!1})},render:function(){var a=null;return null!==this.props.leaveReasons&&(a=this.props.leaveReasons.join("<br />")),React.createElement("div",{className:"total-complete text-center"},React.createElement("div",{className:"big-number","data-content":a},this.props.totalComplete),React.createElement("div",null,"Total",React.createElement("br",null),"Visits"))}}),SummaryTotalWaiting=React.createClass({displayName:"SummaryTotalWaiting",getDefaultProps:function(){return{totalWaiting:0}},render:function(){return React.createElement("div",{className:"total-waiting text-center"},React.createElement("div",{className:"big-number"},this.props.totalWaiting),React.createElement("div",null,"Waiting"))}}),SummaryEstimatedWait=React.createClass({displayName:"SummaryEstimatedWait",getDefaultProps:function(){return{estimatedWait:0}},render:function(){return React.createElement("div",{className:"estimated-wait text-center"},React.createElement("div",null,React.createElement("span",{className:"big-number"},this.props.estimatedWait),React.createElement("span",null,"min")),React.createElement("div",null,"Est. Wait"))}}),SummaryWaitingTally=React.createClass({displayName:"SummaryWaitingTally",getDefaultProps:function(){return{emergency:0,walkin:0,appointment:0,other:0,showLabels:!0}},render:function(){return React.createElement("div",null,React.createElement("table",{className:"tally"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{className:"text-center"},React.createElement("i",{className:"fa fa-exclamation-triangle"})),this.props.showLabels?React.createElement("td",null,"Emergency"):null,React.createElement("td",null,this.props.emergency)),React.createElement("tr",null,React.createElement("td",{className:"text-center"},React.createElement("i",{className:"fa fa-male"})),this.props.showLabels?React.createElement("td",null,"Walk-in"):null,React.createElement("td",null,this.props.walkin)),React.createElement("tr",null,React.createElement("td",{className:"text-center"},React.createElement("i",{className:"fa fa-clock-o"})),this.props.showLabels?React.createElement("td",null,"Appointment"):null,React.createElement("td",null,this.props.appointment)),React.createElement("tr",null,React.createElement("td",{className:"text-center"},React.createElement("i",{className:"fa fa-question-circle"})),this.props.showLabels?React.createElement("td",null,"Other"):null,React.createElement("td",null,this.props.other)))))}}),SummaryTotalSeen=React.createClass({displayName:"SummaryTotalSeen",getDefaultProps:function(){return{totalSeen:0}},render:function(){return React.createElement("div",{className:"total-seen text-center"},React.createElement("div",{className:"big-number"},this.props.totalSeen),React.createElement("div",null,"Seen"))}}),SummaryAverageWait=React.createClass({displayName:"SummaryAverageWait",getDefaultProps:function(){return{averageWait:0}},render:function(){return React.createElement("div",{className:"average-wait text-center"},React.createElement("div",null,React.createElement("span",{className:"big-number"},this.props.averageWait),React.createElement("span",null,"min")),React.createElement("div",null,"Avg. Wait"))}}),Emergency=React.createClass({displayName:"Emergency",mixins:["ButtonGroup"],getInitialState:function(){return{}},getDefaultProps:function(){return{list:null}},render:function(){if(null===this.props.list)return null;var a=this.props.list.map(function(a,b){return React.createElement(EmergencyRow,_extends({key:b},a,{reload:this.props.reload}))}.bind(this));return React.createElement("div",{className:"emergency"},a)}}),EmergencyRow=React.createClass({displayName:"EmergencyRow",getDefaultProps:function(){return{visit:null,reload:null}},saveToClipboard:function(){$(this.refs.bannerId).select(),document.execCommand("copy")},render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-1"},React.createElement("i",{className:"fa fa-lg fa-exclamation-triangle"})),React.createElement("div",{className:"col-sm-2 visitor-name"},this.props.visitor.preferred_name," ",this.props.visitor.last_name),React.createElement("div",{className:"col-sm-3"},React.createElement("input",{size:"11",ref:"bannerId",value:this.props.visitor.banner_id}),"Â ",React.createElement("button",{title:"Copy to clipboard",onClick:this.saveToClipboard},React.createElement("i",{className:"glyphicon glyphicon-copy"}))),React.createElement("div",{className:"col-sm-2"},this.props.wait_time," min"),React.createElement("div",{className:"col-sm-3"},React.createElement(WaitingListStatus,{visitor:this.props.visitor,reload:this.props.reload,visitNumber:this.props.total_visits})),React.createElement("div",{className:"col-sm-1"},React.createElement(WaitingAction,{visitId:this.props.id,reload:this.props.reload})))}}),Waiting=React.createClass({displayName:"Waiting",render:function(){return void 0===this.props.emergency&&void 0===this.props.waiting?React.createElement("div",{className:"text-muted text-center"},React.createElement("i",{style:{fontSize:"200px"},className:"fa fa-smile-o"}),React.createElement("p",{style:{fontSize:"100px"}},"All clear!")):React.createElement("div",null,React.createElement(Emergency,{list:this.props.emergency,reload:this.props.reload}),React.createElement(WaitingList,{list:this.props.waiting,reload:this.props.reload}))}}),WaitingList=React.createClass({displayName:"WaitingList",getDefaultProps:function(){return{list:null,reload:null}},render:function(){var a=null;return null==this.props.list?React.createElement("div",null):(a=this.props.list.map(function(a,b){return React.createElement(WaitingListRow,_extends({},a,{count:b,key:b,reload:this.props.reload}))}.bind(this)),React.createElement("div",{className:"waiting-list"},React.createElement("table",{className:"table table-striped"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"#"),React.createElement("th",null,"Â "),React.createElement("th",null,"Name"),React.createElement("th",null,"Banner id"),React.createElement("th",null,"Wait time"),React.createElement("th",null,"Visits"),React.createElement("th",null,"Status"),React.createElement("th",null,"Â ")),a))))}}),WaitingListRow=React.createClass({displayName:"WaitingListRow",getDefaultProps:function(){return{value:{},count:0,reload:null,visitor:null}},saveToClipboard:function(){$(this.refs.bannerId).select(),document.execCommand("copy")},render:function(){var a=this.props.count+1;return React.createElement("tr",null,React.createElement("td",{style:{width:"3%"}},a),React.createElement("td",{style:{width:"3%"},className:"text-center"},React.createElement(CategoryIcon,{category:this.props.category,reasonTitle:this.props.reason_title})),React.createElement("td",null,React.createElement(VisitorName,{visitor:this.props.visitor})),React.createElement("td",null,React.createElement("input",{size:"11",ref:"bannerId",value:this.props.visitor.banner_id}),"Â ",React.createElement("button",{title:"Copy to clipboard",onClick:this.saveToClipboard},React.createElement("i",{className:"glyphicon glyphicon-copy"}))),React.createElement("td",null,this.props.wait_time," min."),React.createElement("td",null,React.createElement(WaitingListVisits,{visitNumber:this.props.total_visits})),React.createElement("td",null,React.createElement(WaitingListStatus,{visitor:this.props.visitor,reload:this.props.reload,visitNumber:this.props.total_visits})),React.createElement("td",null,React.createElement(WaitingAction,{visitId:this.props.id,reload:this.props.reload})))}}),VisitorName=React.createClass({displayName:"VisitorName",getInitialState:function(){return{tooltip:!0}},getDefaultProps:function(){return{visitor:null}},componentDidMount:function(){this.state.tooltip&&($("span.visitor-name").tooltip({animation:!0,placement:"right"}),this.setState({tooltip:!1}))},render:function(){if(this.props.visitor.first_name!==this.props.visitor.preferred_name){var a=this.props.visitor.first_name+' "'+this.props.visitor.preferred_name+'" '+this.props.visitor.last_name;return React.createElement("span",{className:"visitor-name","data-toggle":"tooltip",title:a},this.props.visitor.preferred_name," ",this.props.visitor.last_name)}return React.createElement("span",null,this.props.visitor.preferred_name," ",this.props.visitor.last_name)}}),CategoryIcon=React.createClass({displayName:"CategoryIcon",getInitialState:function(){return{tooltip:!0}},getDefaultProps:function(){return{category:0,reasonTitle:null}},componentDidMount:function(){this.state.tooltip&&($("i.category").tooltip({animation:!0,placement:"right"}),this.setState({tooltip:!1}))},render:function(){var a=null,b="category fa fa-lg "+categoryIcons[this.props.category];return a=React.createElement("i",{className:b,"data-toggle":"tooltip",title:this.props.reasonTitle}),React.createElement("div",null,a)}}),WaitingListVisits=React.createClass({displayName:"WaitingListVisits",getDefaultProps:function(){return{visitNumber:"0"}},render:function(){switch(this.props.visitNumber){case"0":return React.createElement("span",null);case"1":return React.createElement("span",{className:"label label-info"},"First visit");case"2":case"3":return React.createElement("span",{className:"label label-primary"},this.props.visitNumber," visits");case"4":case"5":return React.createElement("span",{className:"label label-warning"},this.props.visitNumber," visits");default:return React.createElement("span",{className:"label label-danger"},this.props.visitNumber," visits")}}}),WaitingAction=React.createClass({displayName:"WaitingAction",getDefaultProps:function(){return{visitId:0}},completeReason:function(a){$.post("counseling/Admin/Dashboard/Waiting",{command:"setCompleteReason",reason:a,visitId:this.props.visitId},null,"json").done(function(a){this.props.reload()}.bind(this))},remove:function(){confirm("Are you sure you want to remove this visitor?")&&$.post("counseling/Admin/Dashboard/Waiting",{command:"delete",visitId:this.props.visitId},null,"json").done(function(a){this.props.reload()}.bind(this))},getOptions:function(){var a=[];return a.push({label:React.createElement("div",null,React.createElement("i",{className:"fa fa-external-link"})," Had to leave"),visitId:this.props.visitId,handleClick:this.completeReason.bind(null,2)},{label:React.createElement("div",null,React.createElement("i",{className:"fa fa-eye-slash"})," Missing"),visitId:this.props.visitId,handleClick:this.completeReason.bind(null,3)},{label:React.createElement("div",null,React.createElement("i",{className:"fa fa-clock-o"})," Made appointment"),visitId:this.props.visitId,handleClick:this.completeReason.bind(null,4)},{divider:!0},{label:React.createElement("div",{className:"text-danger"},React.createElement("i",{className:"fa fa-trash-o"})," Remove"),visitId:this.props.visitId,handleClick:this.remove}),a},render:function(){var a=this.getOptions();return React.createElement(ButtonGroup,{options:a})}}),refreshDashboard=null,Dashboard=React.createClass({displayName:"Dashboard",getInitialState:function(){return{refresh:!0,emergencyList:null,waitingList:null,summary:null,time:null}},componentDidMount:function(){this.loadData()},refresh:function(){this.state.refresh&&(refreshDashboard=setInterval(function(){this.loadData()}.bind(this),3e4))},loadData:function(){clearInterval(refreshDashboard),$.getJSON("counseling/Admin/Dashboard/Waiting",{command:"list"}).done(function(a){this.setState({emergencyList:a.emergencies,waitingList:a.waiting,summary:a.summary,time:a.time}),this.refresh()}.bind(this))},render:function(){return React.createElement("div",{className:"dashboard"},React.createElement(Summary,{data:this.state.summary,time:this.state.time,reload:this.loadData}),React.createElement(Waiting,{emergency:this.state.emergencyList,waiting:this.state.waitingList,reload:this.loadData}))}});ReactDOM.render(React.createElement(Dashboard,null),document.getElementById("dashboard"));