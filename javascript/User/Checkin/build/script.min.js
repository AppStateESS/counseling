"use strict";var errorTimeout={componentDidUpdate:function(){this.state.error===!0&&(this.interval=setTimeout(function(){this.resetForm()}.bind(this),5e3))},componentWillUnmount:function(){clearTimeout(this.interval)},resetForm:function(){clearTimeout(this.interval),this.setState({error:!1})}},ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,swipeTimeout=null,Swipe=React.createClass({displayName:"Swipe",mixins:[errorTimeout],getInitialState:function(){return{error:0,visitor:null}},getDefaultProps:function(){return{handleClick:null}},loginFailure:function(){this.setState({visitor:"",error:1}),this.timedReset()},alreadyVisiting:function(){this.setState({visitor:"",error:2})},timedReset:function(){swipeTimeout=setTimeout(function(){this.resetSwipe()}.bind(this),4e3)},resetSwipe:function(){clearTimeout(swipeTimeout),this.setState({error:0,visitor:null})},logInVisitor:function(){var a=this.state.visitor;a&&a.length>3?(";"===a.charAt(0)&&"="===a.charAt(10)&&(a=a.slice(1,10)),$.getJSON("counseling/User/Checkin",{command:"loginVisitor",bannerId:a}).done(function(a){void 0!==a.waiting?(this.alreadyVisiting(),this.timedReset()):null===a.visitor?this.loginFailure():this.props.update(a)}.bind(this)).fail(function(){this.loginFailure()}.bind(this))):this.loginFailure()},handleChange:function(a){var b=a.target.value;this.setState({visitor:b})},submitVisitor:function(a){a.preventDefault(),this.logInVisitor()},focusSwiper:function(){$("#swiper").focus()},componentDidUpdate:function(a,b){this.focusSwiper()},componentDidMount:function(a,b){this.focusSwiper()},render:function(){var a=null,b=null;1===this.state.error?a=React.createElement("div",{className:"text-center"},React.createElement("div",{className:"alert alert-danger alert-dismissible",role:"alert",ref:"errorAlert"},"Account not found. Please try again or see the front desk."),React.createElement("button",{className:"btn btn-default",type:"button",onClick:this.resetSwipe},React.createElement("i",{className:"fa fa-repeat"})," Try again")):2===this.state.error?a=React.createElement("div",{className:"alert alert-warning alert-dismissible",role:"alert",ref:"errorAlert"},React.createElement("button",{className:"close",type:"button",onClick:this.resetSwipe},React.createElement("i",{className:"fa fa-times"})),"You are already logged in. Please visit the front desk if you have a question or concern."):(a=React.createElement("input",{id:"swiper",type:"text",placeholder:"Banner ID",onChange:this.handleChange,className:"form-control",value:this.state.visitor}),b=React.createElement("button",{className:"continue pull-right btn btn-default",onClick:this.logInVisitor},"Continue ",React.createElement("i",{className:"fa fa-chevron-right fa-sm"})));var c=React.createElement("div",null,React.createElement("div",{className:"text-center"},React.createElement("p",{className:"title"},"Welcome! Please Check-in"),React.createElement("p",{className:"subtitle"},"Swipe your AppCard to get started"),React.createElement("p",null,"Don't have your AppCard?",React.createElement("br",null),"Enter your Banner ID number instead."),React.createElement("form",{onSubmit:this.submitVisitor},a)),b,React.createElement("div",{className:"clearfix"}));return React.createElement(Box,{content:c})}}),Reason=React.createClass({displayName:"Reason",getInitialState:function(){return{reasons:null}},getDefaultProps:function(){return{update:null,visitor:null}},componentDidMount:function(){$.getJSON("counseling/User/Reason",{command:"list"}).done(function(a){null===a&&(a=[]),this.setState({reasons:a})}.bind(this))},pickReason:function(a){this.props.update(this.state.reasons[a])},render:function(){var a;if(null===this.state.reasons)a="Loading...";else if(0===this.state.reasons.length)a=React.createElement("div",{className:"alert alert-danger"},"System error: Please alert front desk.");else{var b=this.state.reasons.map(function(a,b){return React.createElement("li",{key:b,className:"list-group-item",style:{cursor:"pointer"},onClick:this.pickReason.bind(this,b)},a.description)}.bind(this));a=React.createElement("div",null,React.createElement("div",{className:"text-center"},React.createElement("p",{className:"title"},"Hello, ",this.props.visitor.preferred_name,"."),React.createElement("p",{className:"title"},"Why are you visiting today?")),React.createElement("ul",{className:"list-group"},b))}return React.createElement(Box,{content:a})}}),Phone=React.createClass({displayName:"Phone",mixins:[errorTimeout],getInitialState:function(){return{phoneNumber:"",error:!1}},getDefaultProps:function(){return{update:null,visitor:null,back:null}},componentDidMount:function(){this.setState({phoneNumber:this.props.visitor.phone_number})},updatePhone:function(){this.state.phoneNumber.length<10?this.setState({error:!0}):this.props.update(this.state.phoneNumber)},handleChange:function(a){this.setState({phoneNumber:a.target.value})},render:function(){var a=null;a=this.state.error?React.createElement("div",{className:"alert alert-danger alert-dismissible",role:"alert",ref:"errorAlert"},React.createElement("button",{className:"close",type:"button",onClick:this.resetForm},React.createElement("i",{className:"fa fa-times"})),"Please enter your cell phone number including your area code."):React.createElement("input",{type:"text",ref:"phone",className:"form-control",placeholder:"Cell phone number with area code",value:this.state.phoneNumber,onChange:this.handleChange});var b=React.createElement("div",null,React.createElement("div",{className:"text-center"},React.createElement("p",{className:"title"},"Ok, ",this.props.visitor.preferred_name,"."),React.createElement("p",{className:"subtitle"},"In case we need to reach you later,",React.createElement("br",null),"please enter your cell phone number."),a,React.createElement("button",{className:"continue pull-left btn btn-default",onClick:this.props.back},React.createElement("i",{className:"fa fa-chevron-left fa-sm"}," Back ")),React.createElement("button",{className:"continue pull-right btn btn-default",onClick:this.updatePhone},"Continue ",React.createElement("i",{className:"fa fa-chevron-right fa-sm"})),React.createElement("div",{className:"clearfix"})));return React.createElement(Box,{content:b})}}),Emergency=React.createClass({displayName:"Emergency",getDefaultProps:function(){return{update:null}},hasEmergency:function(a){this.props.update(a)},render:function(){var a=React.createElement("div",null,React.createElement("div",{className:"text-center"},React.createElement("p",{className:"title"},"A few quick questions"),React.createElement("p",{className:"subtitle"},"Are you currently experiencing an emergency?"),React.createElement("p",{style:{textAlign:"left"}},"Examples of emergencies include recent:"),React.createElement("ul",null,React.createElement("li",null,"suicidal crisis"),React.createElement("li",null,"sexual assault"),React.createElement("li",null,"homicidal thoughts"),React.createElement("li",null,"death of a friend or loved one"),React.createElement("li",null,"unusual experiences such as hearing voices or seeing things other people do not"),React.createElement("li",null,"serious accident"),React.createElement("li",null,"other similar events")),React.createElement("button",{style:{marginRight:"1em",width:"100px"},className:"btn btn-default btn-lg",onClick:this.hasEmergency.bind(this,!0)},"Yes"),React.createElement("button",{style:{width:"100px"},className:"btn btn-default btn-lg",onClick:this.hasEmergency.bind(this,!1)},"No")),React.createElement("div",{className:"clearfix"}));return React.createElement(Box,{content:a})}}),Instruction=React.createClass({displayName:"Instruction",getInitialState:function(){return{instructions:null}},getDefaultProps:function(){return{instruction:"1",instructionList:null,reset:null}},render:function(){var a=null,b=null;return b="1"===this.props.instruction?this.props.instructionList[1]:this.props.instructionList[2],a=React.createElement("div",null,React.createElement("div",{className:"text-center"},React.createElement("p",{className:"title"},"Ok, you're checked in."),React.createElement("p",{className:"subtitle"},b)),React.createElement("div",{className:"text-right"},React.createElement("button",{className:"btn btn-default",onClick:this.props.reset},"Finished"))),React.createElement(Box,{content:a})}}),resetTimeout=null,Login=React.createClass({displayName:"Login",getInitialState:function(){return{stage:"swipe"}},updateStage:function(a){this.setState({stage:a})},render:function(){return React.createElement(Stage,{updateStage:this.updateStage,stage:this.state.stage})}}),Stage=React.createClass({displayName:"Stage",getInitialState:function(){return{visitor:null,reason:null,phone:null,emergency:!1,instructionList:null}},getDefaultProps:function(){return{stage:"swipe"}},componentDidMount:function(){$.getJSON("counseling/User/Checkin",{command:"instructions"}).done(function(a){this.setState({instructionList:a})}.bind(this))},updateReason:function(a){this.setState({reason:a}),"1"===a.ask_for_phone?this.props.updateStage("phone"):"1"===a.show_emergency?this.props.updateStage("emergency"):this.props.updateStage("instruction")},updateVisitor:function(a){this.setState({visitor:a}),this.props.updateStage("reason")},updatePhone:function(a){null!==a&&0!==a.length&&(a!==this.state.visitor.phone_number&&$.post("counseling/User/Visitor",{command:"updatePhone",visitorId:this.state.visitor.id,phoneNumber:a},null,"json").done(function(a){}.bind(this)),this.setState({phone:a}),"1"===this.state.reason.show_emergency?this.props.updateStage("emergency"):this.props.updateStage("instruction"))},updateEmergency:function(a){this.setState({emergency:a}),this.props.updateStage("instruction")},componentDidUpdate:function(a,b){"instruction"===this.props.stage&&this.completeCheckin()},completeCheckin:function(){"1"===this.state.reason.wait_listed?$.post("counseling/User/Visit",{command:"create",visitorId:this.state.visitor.id,reasonId:this.state.reason.id,emergency:this.state.emergency},null,"json").done(function(a){resetTimeout=setTimeout(this.resetLogin,5e3)}.bind(this)):resetTimeout=setTimeout(this.resetLogin,5e3)},resetLogin:function(){clearTimeout(resetTimeout),this.props.updateStage("swipe"),this.setState({visitor:null,reason:null,phone:null,emergency:!1})},backToReason:function(){this.setState({reason:null}),this.props.updateStage("reason")},render:function(){switch(this.props.stage){case"swipe":return React.createElement(Swipe,{update:this.updateVisitor});case"reason":return React.createElement(Reason,{update:this.updateReason,visitor:this.state.visitor});case"phone":return React.createElement(Phone,{update:this.updatePhone,visitor:this.state.visitor,back:this.backToReason});case"emergency":return React.createElement(Emergency,{update:this.updateEmergency});case"instruction":return React.createElement(Instruction,{reset:this.resetLogin,instruction:this.state.reason.instruction,instructionList:this.state.instructionList})}}}),Box=React.createClass({displayName:"Box",getDefaultProps:function(){return{content:"Empty"}},render:function(){return React.createElement("div",{className:"checkin-box"},this.props.content)}});ReactDOM.render(React.createElement(Login,null),document.getElementById("Login"));